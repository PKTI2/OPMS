<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui" xmlns:P="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:test="http://mkyong.com/facelets"
                template="/templates/mainTemplate.xhtml">
    <ui:define name="content">

        <script type="text/javascript">
            function handleDrop(event, ui) {
                var droppedCar = ui.draggable;
            }
        </script>
        <p:panel header="Definicje badań">
            <h:form id="definitionsForm">
                <p:toolbar>
                    <f:facet name="left">
                        <p:commandButton type="button" value="Nowy" icon="ui-icon-document"
                                         onclick="PF('addDlg').show();"/>
                        <p:commandButton type="button" value="Przeglądaj" icon="ui-icon-folder-open"/>
                        <p:commandButton value="Unieważnij" icon="ui-icon-trash"
                                         actionListener="#{controller.deprecate()}"/>
                    </f:facet>
                </p:toolbar>
                <p:dataTable id="definitionsTable" value="#{defDataModel}" var="item"
                             rows="10"
                             selectionMode="single"
                             selection="#{controller.selected}" rowKey="#{item.id}"
                             paginator="true"
                             lazy="true"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             rowsPerPageTemplate="10,20,30"
                             widgetVar="defTableWidget">
                    <p:column headerText="Nazwa" sortBy="#{item.name}" filterBy="#{item.name}">
                        <p:outputLabel value="#{item.name}"/>
                    </p:column>
                    <p:column headerText="Przestarzały" filterBy="#{item.deprecated}" sortBy="#{item.deprecated}"
                              filterMatchMode="exact">
                        <p:outputLabel value="#{item.deprecated}"/>
                        <f:facet name="filter">
                            <p:selectOneButton onchange="PF('defTableWidget').filter()">
                                <f:converter converterId="javax.faces.Boolean"/>
                                <f:selectItem itemLabel="Tak/Nie" itemValue=""/>
                                <f:selectItem itemLabel="Tak" itemValue="true"/>
                                <f:selectItem itemLabel="Nie" itemValue="false"/>
                            </p:selectOneButton>
                        </f:facet>
                    </p:column>
                </p:dataTable>
            </h:form>
            <!--DIALOGS-->

            <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                <p:commandButton value="Tak" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                <p:commandButton value="Nie" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
            </p:confirmDialog>

            <p:dialog header="Dodaj" widgetVar="addDlg" minHeight="40" height="400" width="800">
                <p:ajax event="close" listener="#{controller.clear}" />
                <h:form id="templateForm">
                    <p:panelGrid columns="2">
                        <p:outputLabel value="Nazwa"/>
                        <p:inputText value="#{controller.current.name}" required="true"/>
                    </p:panelGrid>
                    <p:panelGrid columns="2">
                        <p:fieldset id="templateField" legend="Szablon">
                            <p:outputPanel id="dropArea">
                                <p:dataTable id="templateTable" value="#{controller.current.nodeEntities}" var="node"
                                             editable="true" editMode="cell" draggableRows="true">

                                    <p:column width="90">
                                        <p:commandButton id="upButton" icon="fa fa-fw fa-arrow-up"/>
                                        <p:commandButton id="downButton" icon="fa fa-fw fa-arrow-down"/>
                                        <p:commandButton id="deleteButton" icon="fa fa-fw fa-remove"/>
                                    </p:column>
                                    <p:column headerText="Nazwa">
                                        <p:cellEditor>
                                            <f:facet name="output"><h:outputText value="#{node.label}"/></f:facet>
                                            <f:facet name="input"><p:inputText id="labelInput"
                                                                               value="#{node.label}" required="true"/></f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                    <p:column headerText="Typ">
                                        <p:cellEditor>
                                            <f:facet name="output">
                                                <h:outputText value="#{node.nodeType}"/>
                                            </f:facet>
                                            <f:facet name="input">
                                                <p:selectOneMenu value="#{node.nodeType}">
                                                    <f:selectItems value="#{controller.nodeTypes}"/>
                                                </p:selectOneMenu>
                                            </f:facet>
                                        </p:cellEditor>
                                    </p:column>
                                </p:dataTable>
                            </p:outputPanel>
                        </p:fieldset>
                        <p:fieldset id="nodesField" legend="Dostępne elementy">
                            <p:dataTable id="availlableNodes" value="#{controller.nodeTypes}" var="node">
                                <p:column style="width:20px">
                                    <h:outputText id="dragIcon" styleClass="ui-icon ui-icon-arrow-4"/>
                                    <p:draggable for="dragIcon" revert="true" helper="clone"/>
                                </p:column>
                                <p:column headerText="Typ">
                                    <p:outputLabel value="#{node}"/>
                                </p:column>
                            </p:dataTable>
                        </p:fieldset>

                        <p:droppable for="templateField" tolerance="touch" activeStyleClass="ui-state-highlight"
                                     datasource="availlableNodes" onDrop="handleDrop">
                            <p:ajax listener="#{controller.onNodeDrop}" update="dropArea templateTable"/>
                        </p:droppable>

                    </p:panelGrid>

                    <p:toolbar>
                        <f:facet name="left">
                            <p:commandButton
                                    onclick="PF('addDlg').hide()"
                                    value="Anuluj" process="@this" immediate="true"/>
                        </f:facet>
                        <f:facet name="right">
                            <p:commandButton value="Dodaj" actionListener="#{controller.save()}"  oncomplete="if (!args.validationFailed &amp;&amp; args.saved) PF('addDlg').hide();"/>
                        </f:facet>
                    </p:toolbar>
                </h:form>
            </p:dialog>
        </p:panel>
    </ui:define>
</ui:composition>
